<!DOCTYPE html>
<html>
<head>
  <title>GameWindow.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = '../', thisFile = 'lib/GameWindow.js', defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#gamewindow">GameWindow</a>
      </div>
      <div class="heading h2">
        <a href="#gamewindow-constructor">GameWindow constructor</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.state">GameWindow.state</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.areloading">GameWindow.areLoading</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.cache">GameWindow.cache</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.currenturis">GameWindow.currentURIs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.globallibs">GameWindow.globalLibs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.framelibs">GameWindow.frameLibs</a>
      </div>
      <div class="heading h2">
        <a href="#gamewindow-methods">GameWindow methods</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.init">GameWindow.init</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getelementbyid">GameWindow.getElementById</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getelementsbytagname">GameWindow.getElementsByTagName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setup">GameWindow.setup</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.injectlibraries">GameWindow.injectLibraries</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.initlibs">GameWindow.initLibs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.precache">GameWindow.preCache</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.load">GameWindow.load</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.updatestatus">GameWindow.updateStatus</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.write">GameWindow.write</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.writeln">GameWindow.writeln</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.toggleinputs">GameWindow.toggleInputs</a>
      </div>
      <div class="heading h2">
        <a href="#gamewindow.addstandardrecipients">GameWindow.addStandardRecipients</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.noescape">GameWindow.noEscape</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.restoreescape">GameWindow.restoreEscape</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.promptonleave">GameWindow.promptOnleave</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.restoreonleave">GameWindow.restoreOnleave</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow">
  <h1>
    <a href="#gamewindow" class="pilcrow">&#182;</a>
    GameWindow
  </h1>
</div>

  </div>
  <div class="body"><p>Copyright(c) 2012 Stefano Balietti
MIT Licensed</p>

<p>GameWindow provides a handy API to interface nodeGame with the 
browser window.</p>

<p>Creates a custom root element inside the HTML page, and insert an
iframe element inside it.</p>

<p>Dynamic content can be loaded inside the iframe without losing the
javascript state inside the page.</p>

<p>Defines a number of pre-defined profiles associated with special
configuration of widgets.</p>

<p>Depends on nodegame-client. 
GameWindow.Table and GameWindow.List depend on NDDB and JSUS.</p>

<p>Widgets can have custom dependencies, which are checked internally 
by the GameWindow engine.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    
<span class="kd">var</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">JSUS</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">Player</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Player</span><span class="p">,</span>
  <span class="nx">PlayerList</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">PlayerList</span><span class="p">,</span>
  <span class="nx">GameState</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameState</span><span class="p">,</span>
  <span class="nx">GameMsg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsg</span><span class="p">,</span>
  <span class="nx">GameMsgGenerator</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsgGenerator</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">DOM</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;DOM&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">DOM</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;DOM object not found. Aborting&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">;</span>
<span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Configuration object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>Default settings</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">promptOnleave</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">loadCache</span><span class="o">:</span>       <span class="kc">true</span><span class="p">,</span>
  <span class="nx">storeCacheNow</span><span class="o">:</span>   <span class="kc">false</span><span class="p">,</span>
  <span class="nx">storeCacheLater</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow-constructor">
  <h2>
    <a href="#gamewindow-constructor" class="pilcrow">&#182;</a>
    GameWindow constructor
  </h2>
</div>

  </div>
  <div class="body"><p>The constructor performs the following operations:</p>


<div class="highlight"><pre><code><span class="o">-</span> <span class="n">creates</span> <span class="n">a</span> <span class="n">root</span> <span class="n">div</span> <span class="n">element</span> <span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>
<span class="o">-</span> <span class="n">creates</span> <span class="n">an</span> <span class="n">iframe</span> <span class="n">element</span> <span class="n">inside</span> <span class="n">the</span> <span class="n">root</span> <span class="n">element</span>  <span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">frame</span><span class="p">)</span>
<span class="o">-</span> <span class="n">defines</span> <span class="n">standard</span> <span class="n">event</span> <span class="n">listeners</span> <span class="k">for</span> <span class="n">showing</span> <span class="n">and</span> <span class="n">hiding</span> <span class="n">elements</span>
</code></pre></div>


  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">GameWindow</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;nodeWindow: no DOM found. Are we in a browser? Aborting.&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;nodeWindow: nodeGame not found&#39;</span><span class="p">,</span> <span class="s1">&#39;ERR&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;nodeWindow: loading...&#39;</span><span class="p">);</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">frame</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// contains an iframe </span>
  <span class="k">this</span><span class="p">.</span><span class="nx">mainframe</span> <span class="o">=</span> <span class="s1">&#39;mainframe&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">conf</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.state">
  <h3>
    <a href="#gamewindow.state" class="pilcrow">&#182;</a>
    GameWindow.state
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">is</span><span class="p">.</span><span class="nx">LOADED</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.areloading">
  <h3>
    <a href="#gamewindow.areloading" class="pilcrow">&#182;</a>
    GameWindow.areLoading
  </h3>
</div>


<p>Counts the number of frames currently being loaded    </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.cache">
  <h3>
    <a href="#gamewindow.cache" class="pilcrow">&#182;</a>
    GameWindow.cache
  </h3>
</div>


<p>Cache for loaded iframes</p>

<p>Maps URI to a cache object with the following properties: <br />
 - <code>contents</code> (a string describing the innerHTML or null if not cached),
 - optionally 'cacheOnClose' (a bool telling whether to cache the frame when
   it is replaced by a new one).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.currenturis">
  <h3>
    <a href="#gamewindow.currenturis" class="pilcrow">&#182;</a>
    GameWindow.currentURIs
  </h3>
</div>


<p>Currently loaded URIs in the internal frames</p>

<p>Maps frame names (e.g. 'mainframe') to the URIs they are showing.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span> <span class="o">=</span> <span class="p">{};</span>

  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.globallibs">
  <h3>
    <a href="#gamewindow.globallibs" class="pilcrow">&#182;</a>
    GameWindow.globalLibs
  </h3>
</div>


<p>Array of strings with the path of the libraries to be loaded in every frame</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">globalLibs</span> <span class="o">=</span> <span class="p">[];</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow.framelibs">
  <h3>
    <a href="#gamewindow.framelibs" class="pilcrow">&#182;</a>
    GameWindow.frameLibs
  </h3>
</div>


<p>Like <code>GameWindow.frameLibs</code>, but contains libraries to be loaded only
in specific frames</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">frameLibs</span> <span class="o">=</span> <span class="p">{};</span>


  <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
  
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow-methods">
  <h2>
    <a href="#gamewindow-methods" class="pilcrow">&#182;</a>
    GameWindow methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.init">
  <h3>
    <a href="#gamewindow.init" class="pilcrow">&#182;</a>
    GameWindow.init
  </h3>
</div>

  </div>
  <div class="body"><p>Sets global variables based on local configuration.</p>

<p>Defaults:</p>


<div class="highlight"><pre><code><span class="o">-</span> <span class="n">promptOnleave</span> <span class="n">TRUE</span>
<span class="o">-</span> <span class="n">captures</span> <span class="n">ESC</span> <span class="n">key</span>
</code></pre></div>


  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Configuration options</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">conf</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">promptOnleave</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">promptOnleave</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">promptOnleave</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">restoreOnleave</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">restoreEscape</span><span class="p">();</span>
  <span class="p">}</span>
  
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getelementbyid">
  <h3>
    <a href="#gamewindow.getelementbyid" class="pilcrow">&#182;</a>
    GameWindow.getElementById
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the element with id 'id'. Looks first into the iframe,
and then into the rest of the page.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getElementsByTagName
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElementById</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">// @TODO: should be init to undefined instead ?</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frame</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">el</span><span class="p">;</span> 
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getelementsbytagname">
  <h3>
    <a href="#gamewindow.getelementsbytagname" class="pilcrow">&#182;</a>
    GameWindow.getElementsByTagName
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a list of elements with the given tag name </p>

<p>Looks first into the iframe and then into the rest of the page.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getElementById

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElementsByTagName</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>@TODO: Should that be more similar to GameWindow.getElementById</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setup">
  <h3>
    <a href="#gamewindow.setup" class="pilcrow">&#182;</a>
    GameWindow.setup
  </h3>
</div>

  </div>
  <div class="body"><p>Setups the page with a predefined configuration of widgets.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">type</span>
      <span class="dox_type">string</span>
      <span>The type of page to setup (MONITOR|PLAYER)</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">){</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>this.root = this.generateNodeGameRoot();</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="p">}</span>
  
  <span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">case</span> <span class="s1">&#39;MONITOR&#39;</span><span class="o">:</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;NextPreviousState&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;GameSummary&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;StateDisplay&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;StateBar&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;DataBar&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;MsgBar&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;GameBoard&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;ServerInfoDisplay&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;Wall&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Add default CSS</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addCSS</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="s1">&#39;/stylesheets/monitor.css&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">break</span><span class="p">;</span>
    
  <span class="k">case</span> <span class="s1">&#39;PLAYER&#39;</span><span class="o">:</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>var maincss        = this.addCSS(this.root, 'style.css');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">header</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateHeader</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">mainframe</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addIFrame</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span><span class="s1">&#39;mainframe&#39;</span><span class="p">);</span>
      
    <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">vs</span>  <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;VisualState&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">header</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">timer</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;VisualTimer&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">header</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>node.game.doneb = node.widgets.append('DoneButton', this.header);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">sd</span>  <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;StateDisplay&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">header</span><span class="p">);</span>

    <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;WaitScreen&#39;</span><span class="p">);</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Add default CSS</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">addCSS</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="s1">&#39;/stylesheets/player.css&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="k">this</span><span class="p">.</span><span class="nx">frame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">mainframe</span><span class="p">];</span> <span class="c1">// there is no document yet</span>
    <span class="kd">var</span> <span class="nx">initPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getBlankPage</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>TODO: inject the no escape code here
not working
this.addJS(initPage, node.conf.host + 'javascripts/noescape.js');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="p">}</span>
    
    <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">mainframe</span><span class="p">].</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">initPage</span><span class="p">;</span>
      
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.injectlibraries">
  <h3>
    <a href="#gamewindow.injectlibraries" class="pilcrow">&#182;</a>
    GameWindow.injectLibraries
  </h3>
</div>

  </div>
  <div class="body"><p>Injects scripts into the iframe</p>

<p>First removes all old injected script tags.
Then injects <code>&lt;script class="injectedlib" src="..."&gt;</code> lines into given
iframe object, one for every given library.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameNode</span>
      <span class="dox_type">object</span>
      <span>The node object of the iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">libs</span>
      <span class="dox_type">array</span>
      <span>An array of strings giving the "src" attribute for the <code>&lt;script&gt;</code>
                    lines to insert</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">injectLibraries</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">frameNode</span><span class="p">,</span> <span class="nx">libs</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">contentDocument</span> <span class="o">=</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span>
                                                  <span class="o">:</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">headNode</span> <span class="o">=</span> <span class="nx">contentDocument</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">scriptNode</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">tagIdx</span><span class="p">,</span> <span class="nx">tag</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">libIdx</span><span class="p">,</span> <span class="nx">lib</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>Remove old tags:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">oldTags</span> <span class="o">=</span> <span class="nx">contentDocument</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s1">&#39;injectedlib&#39;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">tagIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">tagIdx</span> <span class="o">&lt;</span> <span class="nx">oldTags</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">tagIdx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tag</span> <span class="o">=</span> <span class="nx">oldTags</span><span class="p">[</span><span class="nx">tagIdx</span><span class="p">];</span>
    <span class="nx">tag</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Inject new tags:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="nx">libIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">libIdx</span> <span class="o">&lt;</span> <span class="nx">libs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">libIdx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lib</span> <span class="o">=</span> <span class="nx">libs</span><span class="p">[</span><span class="nx">libIdx</span><span class="p">];</span>
    <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
    <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;injectedlib&#39;</span><span class="p">;</span>
    <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">lib</span><span class="p">;</span>
    <span class="nx">headNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.initlibs">
  <h3>
    <a href="#gamewindow.initlibs" class="pilcrow">&#182;</a>
    GameWindow.initLibs
  </h3>
</div>

  </div>
  <div class="body"><p>Specifies the libraries to be loaded automatically in the iframes</p>

<p>This method must be called before any calls to GameWindow.load and GameWindow.preCache .</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">globalLibs</span>
      <span class="dox_type">array</span>
      <span>Array of strings describing absolute library paths that
   should be loaded in every iframe.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameLibs</span>
      <span class="dox_type">object</span>
      <span>Map from URIs to string arrays (as above) specifying
   libraries that should only be loaded for iframes displaying the given URI.
   This must not contain any elements that are also in globalLibs.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initLibs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">globalLibs</span><span class="p">,</span> <span class="nx">frameLibs</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">globalLibs</span> <span class="o">=</span> <span class="nx">globalLibs</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">frameLibs</span> <span class="o">=</span> <span class="nx">frameLibs</span> <span class="o">||</span> <span class="p">{};</span>
<span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.precache">
  <h3>
    <a href="#gamewindow.precache" class="pilcrow">&#182;</a>
    GameWindow.preCache
  </h3>
</div>

  </div>
  <div class="body"><p>Loads the HTML content of the given URIs into the cache</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uris</span>
      <span class="dox_type">array</span>
      <span>The URIs to cache</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">callback</span>
      <span class="dox_type">function</span>
      <span>The function to call once the caching is done</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preCache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uris</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Don't preload if no URIs are given:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uris</span> <span class="o">||</span> <span class="o">!</span><span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Keep count of loaded URIs:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">loadedCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">uriIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">uriIdx</span> <span class="o">&lt;</span> <span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">uriIdx</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">currentUri</span> <span class="o">=</span> <span class="nx">uris</span><span class="p">[</span><span class="nx">uriIdx</span><span class="p">];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>console.log('DEBUG: Caching "' + currentUri + '"...');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>Create an invisible internal frame for the current URI:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">iframeName</span> <span class="o">=</span> <span class="s1">&#39;tmp_iframe_&#39;</span> <span class="o">+</span> <span class="nx">uriIdx</span><span class="p">;</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
    <span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Register the onload handler:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">thisIframe</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">frameDocumentElement</span> <span class="o">=</span>
          <span class="p">(</span><span class="nx">thisIframe</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="nx">thisIframe</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">:</span> <span class="nx">thisIframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Store the contents in the cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">contents</span><span class="o">:</span> <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">,</span>
                            <span class="nx">cacheOnClose</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Remove the internal frame:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">thisIframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>Increment loaded URIs counter:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="o">++</span> <span class="nx">loadedCount</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">loadedCount</span> <span class="o">&gt;=</span> <span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>All requested URIs have been loaded at this point.
console.log('DEBUG: preCache done!');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">})(</span><span class="nx">currentUri</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Start loading the page:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">iframeName</span><span class="p">].</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">currentUri</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.load">
  <h3>
    <a href="#gamewindow.load" class="pilcrow">&#182;</a>
    GameWindow.load
  </h3>
</div>

  </div>
  <div class="body"><p>Loads content from an uri (remote or local) into the iframe, 
and after it is loaded executes the callback function. </p>

<p>The third parameter is an options object with the following fields
(any fields left out assume the default setting):</p>

<ul>
<li>frame (string): The name of the frame in which to load the uri (default: default iframe of the game)</li>
<li>cache (object): Caching options.  Fields:
<ul><li>loadMode (string): 'reload' (default; reload page without the cache),
                  'cache' (get the page from cache if possible)</li>
<li>storeMode (string): 'off' (default; don't cache page),
                   'onLoad' (cache given page after it is loaded)
                   'onClose' (cache given page after it is replaced by a new page)</li></ul></li>
</ul>

<p>Warning: Security policies may block this methods, if the 
content is coming from another domain.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uri</span>
      <span class="dox_type">string</span>
      <span>The uri to load</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>The callback function to call once the DOM is ready</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">opts</span>
      <span class="dox_type">object</span>
      <span>The options object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadFrame</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>Default options:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">frame</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">mainframe</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">loadCache</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">loadCache</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">storeCacheNow</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">storeCacheLater</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Get options:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">frame</span><span class="p">)</span> <span class="nx">frame</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">frame</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span> <span class="o">===</span> <span class="s1">&#39;reload&#39;</span><span class="p">)</span> <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span> <span class="o">===</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span> <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;onLoad&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;onClose&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>Get the internal frame object:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">frameNode</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">frameDocumentElement</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>Query readiness (so we know whether onload is going to be called):</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">frameReady</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>...reduce it to a boolean:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">frameReady</span> <span class="o">=</span> <span class="p">(</span><span class="nx">frameReady</span> <span class="o">===</span> <span class="s1">&#39;interactive&#39;</span> <span class="o">||</span> <span class="nx">frameReady</span> <span class="o">===</span> <span class="s1">&#39;complete&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>If the last frame requested to be cached on closing, do that:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">lastURI</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span><span class="p">[</span><span class="nx">frame</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">((</span><span class="nx">lastURI</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">lastURI</span><span class="p">].</span><span class="nx">cacheOnClose</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">frameNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
    <span class="nx">frameDocumentElement</span> <span class="o">=</span>
      <span class="p">(</span><span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">:</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">lastURI</span><span class="p">].</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Create entry for this URI in cache object and store cacheOnClose flag:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">uri</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">contents</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cacheOnClose</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">cacheOnClose</span> <span class="o">=</span> <span class="nx">storeCacheLater</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Update frame's currently showing URI:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span><span class="p">[</span><span class="nx">frame</span><span class="p">]</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">is</span><span class="p">.</span><span class="nx">LOADING</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span><span class="o">++</span><span class="p">;</span>  <span class="c1">// keep track of nested call to loadFrame</span>
  
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>Add the onload event listener:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">)</span> <span class="p">{</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>TODO: inject the no escape code here</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>that.addJS(iframe.document, node.conf.host + 'javascripts/noescape.js');
that.addJS(that.getElementById('mainframe'), node.conf.host + 'javascripts/noescape.js');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="p">}</span>

    <span class="nx">frameNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
    <span class="nx">frameDocumentElement</span> <span class="o">=</span>
      <span class="p">(</span><span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">:</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loadCache</span> <span class="o">&amp;&amp;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>Load frame from cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>console.log("DEBUG: Loaded in onload from '"+uri+"'");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>Inject libraries:
console.log("DEBUG: Before injection: " + frameDocumentElement.innerHTML);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">that</span><span class="p">.</span><span class="nx">injectLibraries</span><span class="p">(</span><span class="nx">frameNode</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">globalLibs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">uri</span> <span class="k">in</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span> <span class="o">?</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">:</span> <span class="p">[]));</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>console.log("DEBUG: After injection: " + frameDocumentElement.innerHTML);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">storeCacheNow</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>Store frame in cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>console.log("DEBUG: Stored as '"+uri+"'");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>console.log("DEBUG: Calling updateStatus from onload...");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">that</span><span class="p">.</span><span class="nx">updateStatus</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">frame</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>Cache lookup:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">loadCache</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>Load iframe contents at this point only if the iframe is already "ready"
(see definition of frameReady), otherwise the contents would be cleared
once the iframe becomes ready.  In that case, iframe.onload will handle the
filling of the contents.
TODO: Fix code duplication between here and onload function.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">frameReady</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>Load frame from cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">frameNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frame</span><span class="p">);</span>
      <span class="nx">frameDocumentElement</span> <span class="o">=</span>
        <span class="p">(</span><span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">?</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentDocument</span> <span class="o">:</span> <span class="nx">frameNode</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>

      <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>console.log("DEBUG: Loaded in loadFrame from '"+uri+"'");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>Inject libraries:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">that</span><span class="p">.</span><span class="nx">injectLibraries</span><span class="p">(</span><span class="nx">frameNode</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">globalLibs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">uri</span> <span class="k">in</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span> <span class="o">?</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">:</span> <span class="p">[]));</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>Update status (onload isn't called if frame was already ready):
console.log("DEBUG: Calling updateStatus from loadFrame...");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">updateStatus</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">frame</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>console.log('DEBUG: URI "' + uri + '" WAS NOT CACHED!');
Update the frame location:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">frame</span><span class="p">].</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span>
  <span class="p">}</span>
  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>Adding a reference to nodeGame also in the iframe</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">frame</span><span class="p">].</span><span class="nb">window</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>

<div class="highlight"><pre><code><span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="err">&#39;</span><span class="n">the</span> <span class="n">frame</span> <span class="n">just</span> <span class="n">as</span> <span class="n">it</span> <span class="n">is</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">window</span><span class="p">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]);</span>
</code></pre></div>



<p>Experimental
    if (uri === 'blank') {
        window.frames[frame].src = this.getBlankPage();
        window.frames[frame].location = '';
    }
    else {
        window.frames[frame].location = uri;
    }</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  
          
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.updatestatus">
  <h3>
    <a href="#gamewindow.updatestatus" class="pilcrow">&#182;</a>
    GameWindow.updateStatus
  </h3>
</div>

  </div>
  <div class="body"><p>Cleans up the window state after an iframe has been loaded</p>

<p>The methods performs the following operations:</p>

<ul>
<li>executes a given callback function, </li>
<li>decrements the counter of loading iframes</li>
<li>set the window state as loaded (eventually)</li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">A</span>
      <span class="dox_type">function</span>
      <span>callback function</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">The</span>
      <span class="dox_type">object</span>
      <span>iframe of reference</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateStatus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">frame</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>Update the reference to the frame obj</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">frame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">frame</span><span class="p">].</span><span class="nb">document</span><span class="p">;</span>
    
  <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">);</span> <span class="c1">// TODO: Pass the right this reference</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>node.log('Frame Loaded correctly!');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="p">}</span>
    
  <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span><span class="o">--</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">is</span><span class="p">.</span><span class="nx">LOADED</span><span class="p">;</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;WINDOW_LOADED&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Attempt to update state, before the window object was loaded&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates and adds a container div with id 'gn_header' to 
the root element. </p>
  </div>
  <div class="body"><p>If an header element has already been created, deletes it, 
and creates a new one.</p>
  </div>
  <div class="details">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateHeader</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">header</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">header</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">header</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">addElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="s1">&#39;gn_header&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>Overriding Document.write and DOM.writeln and DOM.write</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_write</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">write</span><span class="p">;</span>
<span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_writeln</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">.</span><span class="nx">writeln</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.write">
  <h3>
    <a href="#gamewindow.write" class="pilcrow">&#182;</a>
    GameWindow.write
  </h3>
</div>

  </div>
  <div class="body"><p>Appends a text string, an HTML node or element inside
the specified root element. </p>

<p>If no root element is specified, the default screen is 
used.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.writeln

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">write</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>    
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">getScreen</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Could not determine where writing&#39;</span><span class="p">,</span> <span class="s1">&#39;ERR&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_write</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.writeln">
  <h3>
    <a href="#gamewindow.writeln" class="pilcrow">&#182;</a>
    GameWindow.writeln
  </h3>
</div>

  </div>
  <div class="body"><p>Appends a text string, an HTML node or element inside
the specified root element, and adds a break element
immediately afterwards.</p>

<p>If no root element is specified, the default screen is 
used.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.write

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">writeln</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">br</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">getScreen</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Could not determine where writing&#39;</span><span class="p">,</span> <span class="s1">&#39;ERR&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_writeln</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">br</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.toggleinputs">
  <h3>
    <a href="#gamewindow.toggleinputs" class="pilcrow">&#182;</a>
    GameWindow.toggleInputs
  </h3>
</div>

  </div>
  <div class="body"><p>Enables / Disables all input in a container with id @id.
If no container with id @id is found, then the whole document is used.</p>

<p>If @op is defined, all the input are set to @op, otherwise, the disabled
property is toggled. (i.e. false means enable, true means disable) </p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggleInputs</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">op</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">inputTags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;button&#39;</span><span class="p">,</span> <span class="s1">&#39;select&#39;</span><span class="p">,</span> <span class="s1">&#39;textarea&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">];</span>

  <span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(;</span><span class="nx">j</span><span class="o">&lt;</span><span class="nx">inputTags</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">all</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">inputTags</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>If op is defined do that
Otherwise toggle</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">state</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">op</span><span class="p">)</span> <span class="o">?</span> <span class="nx">op</span> 
                        <span class="o">:</span> <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">disabled</span> <span class="o">?</span> <span class="kc">false</span> 
                                  <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">disabled</span> <span class="o">=</span> <span class="nx">state</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">all</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates a div element with the given id and 
tries to append it in the following order to:</p>
  </div>
  <div class="body"><ul>
<li>the specified root element
<ul><li>the body element</li>
<li>the last element of the document</li></ul></li>
</ul>

<p>If it fails, it creates a new body element, appends it
to the document, and then appends the div element to it.</p>

<p>Returns the newly created root element.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private

</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_generateRoot</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">lastElementChild</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addElement</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="nb">document</span><span class="p">);</span>
    <span class="nx">root</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates a div element with id 'nodegame' and returns it.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow._generateRoot()

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateNodeGameRoot</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_generateRoot</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="s1">&#39;nodegame&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates a div element with id 'nodegame' and returns it.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow._generateRoot()

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateRandomRoot</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_generateRoot</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateUniqueId</span><span class="p">());</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>Useful</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates an HTML button element that will emit the specified
nodeGame event when clicked and returns it.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getEventButton</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getButton</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">);</span>
  <span class="nx">b</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds an EventButton to the specified root element.</p>
  </div>
  <div class="body"><p>If no valid root element is provided, it is append as last element
in the current screen.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getEventButton

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addEventButton</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>

<div class="highlight"><pre><code>    <span class="n">var</span> <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">||</span> <span class="n">this</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">body</span><span class="p">;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">lastElementChild</span> <span class="o">||</span> <span class="n">root</span><span class="p">;</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getScreen</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">eb</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getEventButton</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">eb</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>Useful API</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates an HTML select element already populated with the 
of the data of other players.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addRecipientSelector</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addStandardRecipients</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.populateRecipientSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getRecipientSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">toSelector</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">toSelector</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">addStandardRecipients</span><span class="p">(</span><span class="nx">toSelector</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">toSelector</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Appends a RecipientSelector element to the specified root element.</p>
  </div>
  <div class="body"><p>Returns FALSE if no valid root element is found.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addRecipientSelector</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addStandardRecipients </span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.populateRecipientSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addRecipientSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">toSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRecipientSelector</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">toSelector</span><span class="p">);</span>    
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.addstandardrecipients">
  <h2>
    <a href="#gamewindow.addstandardrecipients" class="pilcrow">&#182;</a>
    GameWindow.addStandardRecipients
  </h2>
</div>

  </div>
  <div class="body"><p>Adds an ALL and a SERVER option to a specified select element.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">toSelector</span>
      <span class="dox_type">object</span>
      <span>An HTML <code>&lt;select&gt;</code> element </span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.populateRecipientSelector
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addStandardRecipients</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toSelector</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="kd">var</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
  <span class="nx">opt</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span><span class="p">;</span>
  <span class="nx">opt</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;ALL&#39;</span><span class="p">));</span>
  <span class="nx">toSelector</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
  <span class="nx">opt</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;SERVER&#39;</span><span class="p">;</span>
  <span class="nx">opt</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s1">&#39;SERVER&#39;</span><span class="p">));</span>
  <span class="nx">toSelector</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
  
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Adds all the players from a specified playerList object to a given
select element.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addStandardRecipients 

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">populateRecipientSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">toSelector</span><span class="p">,</span> <span class="nx">playerList</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span>  <span class="k">typeof</span> <span class="nx">playerList</span> <span class="o">||</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">toSelector</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">removeChildrenFromNode</span><span class="p">(</span><span class="nx">toSelector</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">addStandardRecipients</span><span class="p">(</span><span class="nx">toSelector</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">players</span><span class="p">,</span> <span class="nx">opt</span><span class="p">;</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87">&#182;</a>
</div>
<p>check if it is a DB or a PlayerList object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">players</span> <span class="o">=</span> <span class="nx">playerList</span><span class="p">.</span><span class="nx">db</span> <span class="o">||</span> <span class="nx">playerList</span><span class="p">;</span> 
  
  <span class="nx">J</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">players</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">opt</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
    <span class="nx">opt</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="nx">opt</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="p">));</span>
    <span class="nx">toSelector</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">opt</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates an HTML select element with all the predefined actions
(SET,GET,SAY,SHOW*) as options and returns it.</p>
  </div>
  <div class="body"><p>*not yet implemented</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addActionSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getActionSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">actionSelector</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">actionSelector</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">populateSelect</span><span class="p">(</span><span class="nx">actionSelector</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">actions</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">actionSelector</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Appends an ActionSelector element to the specified root element.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getActionSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addActionSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">actionSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getActionSelector</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">actionSelector</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Creates an HTML select element with all the predefined targets
(HI,TXT,DATA, etc.) as options and returns it.</p>
  </div>
  <div class="body"><p>*not yet implemented</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addActionSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTargetSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">targetSelector</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">targetSelector</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">populateSelect</span><span class="p">(</span><span class="nx">targetSelector</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">targets</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">targetSelector</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Appends a Target Selector element to the specified root element.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getTargetSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addTargetSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">targetSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getTargetSelector</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">targetSelector</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>@experimental</p>
  </div>
  <div class="body"><p>Creates an HTML text input element where a nodeGame state can
be inserted. This method should be improved to automatically
show all the available states of a game.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addActionSelector
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getStateSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">stateSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getTextInput</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">stateSelector</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>@experimental</p>
  </div>
  <div class="body"><p>Appends a StateSelector to the specified root element.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getActionSelector

  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addStateSelector</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">root</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">stateSelector</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getStateSelector</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">stateSelector</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>Do we need it?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Overrides JSUS.DOM.generateUniqueId</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateUniqueId</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">||</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">found</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  
  <span class="k">while</span> <span class="p">(</span><span class="nx">found</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="nx">found</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">id</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96">&#182;</a>
</div>
<p>Where to place them?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.noescape">
  <h3>
    <a href="#gamewindow.noescape" class="pilcrow">&#182;</a>
    GameWindow.noEscape
  </h3>
</div>

  </div>
  <div class="body"><p>Binds the ESC key to a function that always returns FALSE.</p>

<p>This prevents socket.io to break the connection with the
server.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">windowObj</span>
      <span class="dox_type">object</span>
      <span>Optional. The window container in which binding the ESC key</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">windowObj</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">windowObj</span> <span class="o">=</span> <span class="nx">windowObj</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
  <span class="nx">windowObj</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">keyCode</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="o">?</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">27</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span> 
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.restoreescape">
  <h3>
    <a href="#gamewindow.restoreescape" class="pilcrow">&#182;</a>
    GameWindow.restoreEscape
  </h3>
</div>

  </div>
  <div class="body"><p>Removes the the listener on the ESC key.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">windowObj</span>
      <span class="dox_type">object</span>
      <span>Optional. The window container in which binding the ESC key</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.noEscape()
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">restoreEscape</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">windowObj</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">windowObj</span> <span class="o">=</span> <span class="nx">windowObj</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
  <span class="nx">windowObj</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.promptonleave">
  <h3>
    <a href="#gamewindow.promptonleave" class="pilcrow">&#182;</a>
    GameWindow.promptOnleave
  </h3>
</div>

  </div>
  <div class="body"><p>Captures the onbeforeunload event, and warns the user
that leaving the page may halt the game.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">windowObj</span>
      <span class="dox_type">object</span>
      <span>Optional. The window container in which binding the ESC key</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">text</span>
      <span class="dox_type">string</span>
      <span>Optional. A text to be displayed in the alert message. </span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <a href=" ">https://developer.mozilla.org/en/DOM/window.onbeforeunload

</a>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">promptOnleave</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">windowObj</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">windowObj</span> <span class="o">=</span> <span class="nx">windowObj</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">text</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">textOnleave</span> <span class="o">:</span> <span class="nx">text</span><span class="p">;</span> 
  <span class="nx">windowObj</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>    
      <span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>For IE&lt;8 and Firefox prior to version 4</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">returnValue</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>For Chrome, Safari, IE8+ and Opera 12+</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.restoreonleave">
  <h3>
    <a href="#gamewindow.restoreonleave" class="pilcrow">&#182;</a>
    GameWindow.restoreOnleave
  </h3>
</div>

  </div>
  <div class="body"><p>Removes the onbeforeunload event listener.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">windowObj</span>
      <span class="dox_type">object</span>
      <span>Optional. The window container in which binding the ESC key</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.promptOnleave</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <a href=" ">https://developer.mozilla.org/en/DOM/window.onbeforeunload

</a>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">restoreOnleave</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">windowObj</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">windowObj</span> <span class="o">=</span> <span class="nx">windowObj</span> <span class="o">||</span> <span class="nb">window</span><span class="p">;</span>
  <span class="nx">windowObj</span><span class="p">.</span><span class="nx">onbeforeunload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103">&#182;</a>
</div>
<p>Do we need these?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Returns the screen of the game, i.e. the innermost element
inside which to display content. </p>
  </div>
  <div class="body"><p>In the following order the screen can be:</p>


<div class="highlight"><pre><code><span class="o">-</span> <span class="n">the</span> <span class="n">body</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">iframe</span> 
<span class="o">-</span> <span class="n">the</span> <span class="n">document</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">iframe</span> 
<span class="o">-</span> <span class="n">the</span> <span class="n">body</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">document</span> 
<span class="o">-</span> <span class="n">the</span> <span class="n">last</span> <span class="n">child</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">document</span>
</code></pre></div>


  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getScreen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span><span class="p">.</span><span class="nx">body</span> <span class="o">||</span> <span class="nx">el</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">lastElementChild</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span>  <span class="nx">el</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Returns the document element of the iframe of the game.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frame</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="s1">&#39;mainframe&#39;</span><span class="p">].</span><span class="nb">document</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106">&#182;</a>
</div>
<p>Expose nodeGame to the global object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">node</span><span class="p">.</span><span class="nb">window</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GameWindow</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">W</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nb">window</span><span class="p">;</span>
  
<span class="p">})(</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107">&#182;</a>
</div>
<p>GameWindow works only in the browser environment. The reference 
to the node.js module object is for testing purpose only</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="o">?</span> <span class="nb">window</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nb">window</span><span class="p">,</span>
  <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">node</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
